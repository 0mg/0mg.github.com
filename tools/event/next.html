<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head class="prevent">
<meta charset="utf-8" />
<title>DOM Event Monitor v2 beta</title>
<style>
html, body, h1, pre, ol, li {
  margin: 0;
  padding: 0;
  border: 0;
  font: 14px monospace;
}
body {
  background: #f9f9f9;
}
#current-type {
  background: black;
  color: white;
}
#current-props {
  white-space: pre-wrap;
}
#current, #log {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 40ex;
  overflow: scroll;
}
#current > *, #log li {
  padding-left: 1ex;
}
#log {
  left: 40ex;
  width: 30ex;
  list-style-type: none;
}
#log li {
  cursor: pointer;
  color: blue;
  text-decoration: none;
}
#log li:hover {
  color: red;
  text-decoration: underline;
}
#control {
  position: absolute;
  top: 0;
  right: 0;
}
.radio-buttons label {
  background: #ccc;
  padding: 0 1ex;
  border: 2px outset white;
}
.radio-buttons label:active {
  border-style: inset;
}
.radio-buttons label:hover {
  background: #ddd;
}
</style>
<script>
if (!Event.prototype.preventDefault) {
  Object.defineProperty(Event.prototype, "preventDefault", {
    get: function() {
      return function() {
        this.returnValue = false;
      }
    }
  });
}
if (!("target" in Event.prototype)) {
  Object.defineProperty(Event.prototype, "target", {
    get: function() {
      return this.srcElement;
    }
  });
}
if (!window.addEventListener) {
  Object.defineProperty(window, "addEventListener", {
    get: function() {
      return function(type, f) {
        return this.attachEvent("on" + type, f);
      };
    }
  });
}
if (!document.addEventListener) {
  Object.defineProperty(document, "addEventListener", {
    get: function() {
      return window.addEventListener;
    }
  });
}
if (!Element.prototype.addEventListener) {
  Object.defineProperty(Element.prototype, "addEventListener", {
    get: function() {
      return window.addEventListener;
    }
  });
}
if (!window.removeEventListener) {
  Object.defineProperty(window, "removeEventListener", {
    get: function() {
      return function(type, f) {
        return this.detachEvent("on" + type, f);
      };
    }
  });
}
if (!document.removeEventListener) {
  Object.defineProperty(document, "removeEventListener", {
    get: function() {
      return window.removeEventListener;
    }
  });
}
if (!Element.prototype.removeEventListener) {
  Object.defineProperty(Element.prototype, "removeEventListener", {
    get: function() {
      return window.removeEventListener;
    }
  });
}
if (!("textContent" in document.createElement("p"))) {
  Object.defineProperty(Element.prototype, "textContent", {
    get: function() { return this.innerText; },
    set: function(s) { return this.innerText = s; }
  });
}
if (!document.createElement("p").classList) {
  Object.defineProperty(Element.prototype, "classList", {
    get: function() {
      var it = this;
      var classes = it.className.replace(/\s+/g, " ").replace(/^ +| +$/g, "");
      return {
        contains: function(s) {
          return (" " + classes + " ").indexOf(" " + s + " ") >= 0;
        },
        add: function(s) {
          if (!this.contains(s)) it.className += " " + s;
        },
        remove: function(s) {
          if (this.contains(s)) {
            it.className = (" " + classes + " ").
              replace(RegExp(" " + s + "(?= )", "g"), "").
              replace(/^ +| +$/g, "");
          }
        },
        toString: function() {
          return it.className;
        }
      };
    }
  });
}
if (!Array.prototype.forEach) {
  Array.prototype.forEach = function(f) {
    for (var i = 0, z = this.length; i < z; ++i) {
      f(this[i], i, this);
    }
  };
}
if (!Array.prototype.map) {
  Array.prototype.map = function(f) {
    for (var a = [], i = 0, z = this.length; i < z; ++i) {
      a[i] = f(this[i], i, this);
    }
    return a;
  };
}
if (!Array.prototype.indexOf) {
  Array.prototype.indexOf = function(v) {
    for (var i = 0, z = this.length; i < z; ++i) {
      if (this[i] === v) return i;
    }
    return -1;
  };
}
if (!Array.prototype.some) {
  Array.prototype.some = function(f) {
    for (var i = 0, z = this.length; i < z; ++i) {
      if (f(this[i], i, this)) return true;
    }
    return false;
  };
}
if (!Object.getOwnPropertyNames) {
  Object.getOwnPropertyNames = function() { return []; };
}
if (!window.console) {
  console = {log:function(){}};
}
</script>
<script>
"use strict";

var EVENT_TYPES = {
  DOM3: [
"abort", "blur", "click", "compositionstart", "compositionupdate", "compositionend", "dblclick", "DOMActivate", "DOMAttributeNameChanged", "DOMAttrModified", "DOMCharacterDataModified", "DOMElementNameChanged", "DOMFocusIn", "DOMFocusOut", "DOMNodeInserted", "DOMNodeInsertedIntoDocument", "DOMNodeRemoved", "DOMNodeRemovedFromDocument", "DOMSubtreeModified", "error", "focus", "focusin", "focusout", "keydown", "keypress", "keyup", "load", "mousedown", "mouseenter", "mouseleave", "mousemove", "mouseout", "mouseover", "mouseup", "resize", "scroll", "select", "textinput", "unload", "wheel"
  ],
  HTML5: [
"abort", "afterprint", "beforeprint", "beforeunload", "blur", "cancel", "canplay", "canplaythrough", "change", "click", "close", "contextmenu", "cuechange", "dblclick", "drag", "dragend", "dragenter", "dragleave", "dragover", "dragstart", "drop", "durationchange", "emptied", "ended", "error", "focus", "hashchange", "input", "invalid", "keydown", "keypress", "keyup", "load", "loadeddata", "loadedmetadata", "loadstart", "message", "mousedown", "mousemove", "mouseout", "mouseover", "mouseup", "mousewheel", "offline", "online", "pagehide", "pageshow", "pause", "play", "playing", "popstate", "progress", "ratechange", "reset", "resize", "scroll", "seeked", "seeking", "select", "show", "stalled", "storage", "submit", "suspend", "timeupdate", "unload", "volumechange", "waiting", "contextmenu", "DOMContentLoaded", "offline", "online", "readystatechange"
  ],
  DOM: [
  ]
};

var evlog = {};


evlog.listenTypes = [];

evlog.listenTypes.init = function() {
  var listen_types = this;
  var all_types = (
    EVENT_TYPES.DOM3).concat(
    EVENT_TYPES.HTML5).concat(
    EVENT_TYPES.DOM).concat(
    );
  all_types.forEach(function(type) {
    if (listen_types.indexOf(type) === -1) {
      listen_types.push(type);
    }
  });
};

evlog.addEventListenerAll = function() {
  evlog.listenTypes.forEach(function(type) {
    window.addEventListener(type, newEventHandlerCaller("window"), true);
    document.addEventListener(type, newEventHandlerCaller("document"), true);
  });
};

var isDescendentOfPreventer = function(e) {
  if (e === window) return false;
  return [].some.call(document.querySelectorAll(".prevent"), function(p) {
    return p.contains(e);
  });
};

var nop = function() {};
var eventHandler = nop;
var newEventHandlerCaller = function(listener_name) {
  return function(event) {
    if (evlog.listener === listener_name &&
      !isDescendentOfPreventer(event.target)) {
      eventHandler(event);
    }
  };
};
var handleEvent = function handleEvent(event) {
  evlog.pushLog(event);
  writeLogList();
  writeCurrentLog(evlog.log[0]);
};

evlog.pushLog = function(event) { //maybe logging also listener's start/stop
  var eva = new EventArchive(event);
  evlog.log.unshift(eva);
  evlog.log.length = evlog.LOG_MAX;
};

var writeLogList = function() {
  var log0 = evlog.log[0];
  var list = document.getElementById("log");
  var li = document.createElement("li");
  li.addEventListener("click", function() {
    writeCurrentLog(log0);
  });
  li.textContent = log0.event.type;
  list.insertBefore(li, list.firstChild);
  while (list.childNodes.length > evlog.log.length) {
    list.removeChild(list.lastChild);
  }
};
var writeCurrentLog = function(eva) {
  var current = eva;
  var props = {all:null,main:[],consts:[],funs:[]};
  for (var i in current.event) {
    var ev = [i, current.event[i]];
    if (!/[a-z]/.test(i)) props.consts.push(ev);
    else if (current.event[i].type === "function") props.funs.push(ev);
    else props.main.push(ev);
  }
  props.main.sort();
  props.consts.sort();
  props.funs.sort();
  props.all = (
    props.main).concat(
    props.consts).concat(
    props.funs).concat(
    );

  var title = document.getElementById("current-type");
  title.textContent = current.event.type;

  var list = document.getElementById("current-props");
  list.textContent = props.all.map(function(e) {
    return "# " + e[0] + ": " + e[1];
  }).join("\n");
};

var EventArchive = function EventArchive(event) {
  this.event = {};
  for (var pn in event) {
    var val = event[pn];
    this.event[pn] = new String(val);
    this.event[pn].type = typeof val;
  }
};

evlog.log = [];

evlog.start = function startLoging() {
  eventHandler = handleEvent;
};
evlog.stop = function stopLoging() {
  eventHandler = nop;
};
evlog.init = function initLoging() {
  eventHandler = nop;
  evlog.log.length = 0;
};


evlog.listener = "window";
evlog.LOG_MAX = 50;

evlog.listenTypes.init();
evlog.addEventListenerAll();
evlog.init();
evlog.start();






</script>
</head>
<body>
<div id="control">
  <fieldset id="lissel" class="radio-buttons">
    <legend>listener</legend>
    <label><input id="lissel-window" name="lissel" type="radio" value="window" />window</label><label><input id="lissel-document" name="lissel" type="radio" value="document" />document</label>
  </fieldset>
  <fieldset id="logsz" class="radio-buttons">
    <legend>log size</legend>
    <label><input id="logsz-10" name="logsz" type="radio" value="10" />10</label><label><input id="logsz-50" name="logsz" type="radio" value="50" />50</label><label><input id="logsz-100" name="logsz" type="radio" value="100" />100</label>
  </fieldset>
  <fieldset id="logsw" class="radio-buttons">
    <legend>loging ON/OFF</legend>
    <label id="logswbox-on"><input id="logsw-on" name="logsw" type="radio" value="on" />ON</label><label id="logswbox-off"><input id="logsw-off" name="logsw" type="radio" value="off" />OFF</label>
  </fieldset>
</div>
<div class="prevent">
  <div class="section" id="current">
    <h1 id="current-type"></h1>
    <pre id="current-props"></pre>
  </div>
  <ol id="log"></ol>
</div>
<script>
document.getElementById("lissel-" + evlog.listener).checked = true;
document.getElementById("logsz-" + evlog.LOG_MAX).checked = true;
document.getElementById("logsw-" +
  (eventHandler === handleEvent ? "on" : "off")).checked = true;
document.getElementById("logsw").addEventListener("click", function(e) {
  if (e.target.id === "logsw-on" && e.target.checked) {
    evlog.start();
  } else if (e.target.id === "logsw-off" && e.target.checked) {
    evlog.stop();
  }
});
document.getElementById("logsz").addEventListener("click", function(e) {
  if (/^logsz-\d+$/.test(e.target.id) && e.target.checked) {
    evlog.LOG_MAX = e.target.value | 0;
  }
});
document.getElementById("lissel").addEventListener("click", function(e) {
  if (/^lissel-(?:window|document)$/.test(e.target.id) &&e.target.checked) {
    evlog.listener = e.target.value;
  }
});
</script>
</body>
</html>
