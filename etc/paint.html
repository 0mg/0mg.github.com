<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
html {
  background: red;
}
body {
  background: #777;
  color: red;
  font-family: monospace;
  line-height: 1.3;
}
#a {
  background: #fff;
  border: 1em solid #99f;
}
#dbgvw {
  background: black;
  color: white;
  min-height: 1em;
  border: 1px dotted;
  margin-bottom: 1ex;
}
form {
  display: inline-block;
  background: yellow;
}
</style>
<script>
addEventListener("load", function() {
  main();
}, true);
function dbg(str) {
  document.querySelector("#dbgvw").textContent = str;
}
function main() {
  var cv = document.querySelector("canvas");
  var c = cv.getContext("2d");
  var onMove = getOnMove(c);
  cv.addEventListener("mousemove", function(e) {
    onMove(e);
  }, false);
  cv.width = window.innerWidth * 0.8;
  cv.height = window.innerHeight * 0.8;
  addEventListener("mousemove", function(e) {
    if (e.target !== cv || !window.clickin) {
      window.hx = e.offsetX;
      window.hy = e.offsetY;
      dbg("hist"+[hx,hy]);
    }
  }, false);
  cv.addEventListener("mousedown", function() {
    window.clickin = true;
    dbg("down");
  }, true);
  addEventListener("mouseup", function() {
    window.clickin = false;
    dbg("up");
  }, true);
  addEventListener("reset", function() {
    c.clearRect(0, 0, cv.width, cv.height);
  }, true);
}
window.clickin = false;
function getOnMove(c) {
  return function onMove(e) {
    if (!window.clickin) return;
    var x = e.offsetX, y = e.offsetY;
    var hx = window.hx || x, hy = window.hy || y;
    var w = 2, h;
    h = w;
    x -= w / 2;
    y -= h / 2;
    dbg([x, y]);
    c.lineWidth = 5;
    c.lineJoin = "round";
    c.beginPath();
    c.moveTo(hx, hy);
    c.lineTo(window.hx = x, window.hy = y);
    c.closePath();
    c.stroke();
  };
};
</script>
<title>paint</title>
</head>
<body>
<div id="dbgvw">?</div>
<canvas id="a" width="400" height="400"></canvas>
<form><input type="reset" id="cls" /></form>
</body>
</html>
