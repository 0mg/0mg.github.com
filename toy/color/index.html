<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8" />
<title>Color</title>
<style>/*<![CDATA[*/
* {
  margin: 0;
  padding: 0;
}
html {
  height: 100%;
  background: #000;
}
body {
  height: 100%;
  background-color: #000;
}
#colorbox {
  position: absolute;
  background-color: rgb(0,0,0);
  width: 100%;
  height: 100%;
}
#history {
  overflow: hidden;
  background: white;
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 30px;
}
#tip {
  position: absolute;
  border: 1px solid;
  background: white;
  color: black;
  display: none;
}
.controller {
  position: absolute;
  top: 0;
  right: 0;
}
.scroll {
  width: 200px;
  overflow-x: scroll;
}
.spacer {
  width: 875%;
  height: 1px;
}
/*]]>*/</style>
</head>
<script>//<![CDATA[
if (!window.addEventListener) {
  window.addEventListener = function(type, f) {
    return this.attachEvent("on" + type, f);
  };
}
if (!Element.prototype.addEventListener) {
  Element.prototype.addEventListener = function() {
    return window.addEventListener.apply(this, arguments);
  };
}
if (!Array.prototype.forEach) {
  Array.prototype.forEach = function(f) {
    for (var i = 0; i < this.length; ++i) {
      f(this[i], i, this);
    }
  };
}
if (!window.getComputedStyle) {
  window.getComputedStyle = function(el) {
    return el.currentStyle;
  };
}
//]]></script>
<script>//<![CDATA[
addEventListener("load", function() {
  var coltar = document.getElementById("colorbox");

  var r = document.getElementById("r");
  var g = document.getElementById("g");
  var b = document.getElementById("b");
  var h = document.getElementById("h");
  var s = document.getElementById("s");
  var l = document.getElementById("l");

  function rgb2hsl(R, G, B) {
    R /= 255;
    G /= 255;
    B /= 255;

    var max = Math.max(R, G, B);
    var min = Math.min(R, G, B);
    var c = max - min;

    var h = max === R ? ((G - B) / c) % 6 :
            max === G ? ((B - R) / c) + 2 :
                        ((R - G) / c) + 4;
    var H = 60 * h;

    var L = (max + min) / 2;

    var S = (L <= 1/2) ? c / (2 * L) : c / (2 - (2 * L));

    H = (H + 360) % 360;
    S *= 100;
    L *= 100;

    H |= 0;
    S |= 0;
    L |= 0;

    return [H, S, L];
  }
  function hsl2rgb(H, S, L) {
    S /= 100;
    L /= 100;

    var c = (1 - Math.abs((2 * L) - 1)) * S;
    var h = H / 60;
    var x = c * (1 - Math.abs((h % 2) - 1));

    var rgb = (0 <= h && h < 1) ? [c, x, 0] :
              (1 <= h && h < 2) ? [x, c, 0] :
              (2 <= h && h < 3) ? [0, c, x] :
              (3 <= h && h < 4) ? [0, x, c] :
              (4 <= h && h < 5) ? [x, 0, c] :
              (5 <= h && h < 6) ? [c, 0, x] :
                                  [0, 0, 0];
    var r = rgb[0];
    var g = rgb[1];
    var b = rgb[2];

    var m = L - (c / 2);

    var R = r + m;
    var G = g + m;
    var B = b + m;

    R *= 255;
    G *= 255;
    B *= 255;

    R |= 0;
    G |= 0;
    B |= 0;

    return [R, G, B];
  }

  function pushHistory(rgb, hsl) {
    var history = document.getElementById("history");

    var his = document.createElement("div");
    his.style.display = "inline-block";
    his.title = [rgb, hsl];
    his.style.background = "rgb(" + rgb + ")";
    his.style.width = "5px";
    his.style.height = "100%";
    his.addEventListener("click", function() {
      setValue(r, rgb[0], 255, true);
      setValue(g, rgb[1], 255, true);
      setValue(b, rgb[2], 255, true);
    }, false);

    history.appendChild(his);
    while (history.childNodes.length > 100) {
      history.removeChild(history.firstChild);
    }
  }

  function getValue(e, val_max) {
    var max = e.scrollWidth - parseInt(getComputedStyle(e,"").width);
    var now = e.scrollLeft;
    var val_now = (val_max / max) * now;
    return val_now;
  }
  function setValue(e, val_now, val_max, noCancel) {
    e.dataCancelEvent = !noCancel;
    var max = e.scrollWidth - parseInt(getComputedStyle(e,"").width);
    var now = e.scrollLeft;
    var now_new = Math.round((max / val_max) * val_now);
    e.scrollLeft = now_new;
  }

  [r, g, b, h, s, l].forEach(function(e) {
    function onSlideRGB() {
      var rgb = [getValue(r, 255), getValue(g, 255), getValue(b, 255)];
      var hsl = rgb2hsl(rgb[0], rgb[1], rgb[2]);
      setValue(h, hsl[0], 359);
      setValue(s, hsl[1], 100);
      setValue(l, hsl[2], 100);
      return [rgb, hsl];
    }
    function onSlideHSL() {
      var hsl = [getValue(h, 359), getValue(s, 100), getValue(l, 100)];
      var rgb = hsl2rgb(hsl[0], hsl[1], hsl[2]);
      setValue(r, rgb[0], 255);
      setValue(g, rgb[1], 255);
      setValue(b, rgb[2], 255);
      return [rgb, hsl];
    }
    var onSlide;
    switch (e) {
    case r: case g: case b:
      onSlide = onSlideRGB;
      break;
    case h: case s: case l:
      onSlide = onSlideHSL;
      break;
    }
    e.addEventListener("scroll", function() {
      if (e.dataCancelEvent) {
        e.dataCancelEvent = false;
        return;
      }
      var data = onSlide();
      var rgb = data[0];
      var hsl = data[1];

      rgb = [rgb[0]|0, rgb[1]|0, rgb[2]|0];
      hsl = [hsl[0]|0, hsl[1]|0, hsl[2]|0];

      coltar.style.backgroundColor = "rgb(" + rgb + ")";
      pushHistory(rgb, hsl);

      var debugData = rgb + "<br>" + hsl;
      document.getElementById("dev").innerHTML = debugData;
    }, false);
  });

}, false);
//]]></script>
<body>
<div id="colorbox">
  <b id="dev" style="background:#fff"> </b>
</div>
<div id="history"></div>
<div id="tip"> </div>
<div class="controller">
  <div class="scroll" id="r">
    <div class="spacer"></div>
  </div>
  <div class="scroll" id="g">
    <div class="spacer"></div>
  </div>
  <div class="scroll" id="b">
    <div class="spacer"></div>
  </div>
  <div class="scroll" id="h">
    <div class="spacer"></div>
  </div>
  <div class="scroll" id="s">
    <div class="spacer"></div>
  </div>
  <div class="scroll" id="l">
    <div class="spacer"></div>
  </div>
</div>
</body>
</html>
